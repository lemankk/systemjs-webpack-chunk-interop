{"version":3,"file":"extras-instantiate.js","sources":["../src/extras-instantiate.js"],"sourcesContent":["(function (global) {\n  const systemPrototype = global.System.constructor.prototype;\n\n  const asyncImportPrefix = \"systemjs://m/\";\n  const getUrl = (id) => asyncImportPrefix + id;\n  systemPrototype.appendImportMap = async function (packages) {\n    const loader = this;\n    loader.asyncMap = loader.asyncMap || {};\n    loader.asyncMap = {\n      ...loader.asyncMap,\n      ...packages,\n    };\n\n    // creating import map from package\n    const packageNames = Object.keys(packages);\n    const sjsMapElm = document.createElement(\"script\");\n\n    // meet import map rules\n    sjsMapElm.type = \"systemjs-importmap\";\n\n    const packageMap = {};\n    for (const name of packageNames) {\n      // Use it directly if the package already provide an url, other assume that is a internal url with import syntax\n      packageMap[name] = typeof packages[name] === \"string\" ? packages[name] : getUrl(name);\n    }\n\n    sjsMapElm.innerText = JSON.stringify({\n      imports: packageMap,\n    });\n    document.head.appendChild(sjsMapElm);\n    return loader.prepareImport(true);\n  };\n  const existingHook = systemPrototype.instantiate;\n  systemPrototype.instantiate = function (url, parentUrl) {\n    var loader = this;\n\n    // use original loader\n    if (url.indexOf(asyncImportPrefix) !== 0) {\n      return existingHook.apply(loader, arguments);\n    }\n    var packageName = url.substr(asyncImportPrefix.length);\n    return new Promise(async (resolve, reject) => {\n      try {\n        const register = loader.getRegister();\n        const importer = loader.asyncMap[packageName];\n\n        // Using Webpack import()\n        const context = await importer();\n\n        loader.set(url, context);\n        resolve(register);\n      } catch (error) {\n        reject(error);\n      }\n    });\n  };\n  // eslint-disable-next-line\n})(typeof self !== \"undefined\" ? self : global);\n"],"names":["global","systemPrototype","System","constructor","prototype","asyncImportPrefix","getUrl","id","appendImportMap","packages","loader","asyncMap","packageNames","Object","keys","sjsMapElm","document","createElement","type","packageMap","name","innerText","JSON","stringify","imports","head","appendChild","prepareImport","existingHook","instantiate","url","parentUrl","indexOf","apply","arguments","packageName","substr","length","Promise","resolve","reject","register","getRegister","importer","context","set","self"],"mappings":"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"}